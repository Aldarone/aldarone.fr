<!DOCTYPE html>
<html lang="fr-fr">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    


    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="Google Takeout, Buzz et l&#39;export des favoris"/>
<meta name="twitter:description" content="Comme annoncé dans un article précédent, Google Reader a mis fin aux partages d&rsquo;articles comme on le connaissait. Dommage pour moi, je m&rsquo;en servais aussi comme outil de bookmarking (un peu comme ce que d&rsquo;autres font avec Delicious)
J&rsquo;ai pu trouver la liste de ces partages en bidouillant des URL (genre ils sont cachés ici: http://www.google.com/reader/shared/06987377928849278758, la solution sautait aux yeux dès le départ !) mais il ne fait aucun doute que ça va bientôt disparaître, cette page comme mes liens."/>

    <meta name="twitter:site" content="@WebScrewdriver"/>



  	<meta property="og:title" content=" Google Takeout, Buzz et l&#39;export des favoris &middot;  Aldarone.fr" />
  	<meta property="og:site_name" content="Aldarone.fr" />
  	<meta property="og:url" content="https://aldarone.fr/google-takeout-buzz-et-lexport-des-favoris" />

    
  	<meta property="og:type" content="article" />

        
            <meta name="og:image" content="https://aldarone.fr/img/cover.png"/>
        

    <meta property="og:article:published_time" content="2011-11-04T00:00:00Z" />

    
    

    <title>
       Google Takeout, Buzz et l&#39;export des favoris &middot;  Aldarone.fr
    </title>

    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://aldarone.fr/images/favicon.ico">
	  <link rel="apple-touch-icon" href="https://aldarone.fr/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="https://aldarone.fr/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://aldarone.fr/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />


    
      
          <link href="https://aldarone.fr/index.xml" rel="alternate" type="application/rss+xml" title="Aldarone.fr" />
      
      
    
    <meta name="generator" content="Hugo 0.17" />

    <link rel="canonical" href="https://aldarone.fr/google-takeout-buzz-et-lexport-des-favoris" />

    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/">Home</a>
            </li>
        
    </ul>
    
    
    <a class="subscribe-button icon-feed" href="https://aldarone.fr/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">




<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Google Takeout, Buzz et l&#39;export des favoris</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2011-11-04T00:00:00Z">
            Nov 4, 2011
          </time>
        
         
        </section>
    </header>

    <section class="post-content">
      <p>Comme annoncé dans un article précédent, Google Reader a mis fin aux partages d&rsquo;articles comme on le connaissait. Dommage pour moi, je m&rsquo;en servais aussi comme outil de bookmarking (un peu comme ce que d&rsquo;autres font avec Delicious)</p>

<p>J&rsquo;ai pu trouver la liste de ces partages en bidouillant des URL (genre ils sont cachés ici: <a href="http://www.google.com/reader/shared/06987377928849278758">http://www.google.com/reader/shared/06987377928849278758</a>, la solution sautait aux yeux dès le départ !) mais il ne fait aucun doute que ça va bientôt disparaître, cette page comme mes liens. Donc il me fallait un moyen de les récupérer.</p>

<p>Heureusement, avec la sortie de Google+, Google a rendu disponible un outil nommé Google Takeout (développé par un groupuscule interne: le Data Liberation Front, les joyeux drilles sur la photo ci-dessus) qui promet de nous permettre de télécharger toutes les données que Google a sur nous. Je m&rsquo;attendais donc à voir une belle option: « Google Reader » dans la liste. Mais non.</p>

<p><img src="https://aldarone.fr/wp-content/uploads/2011/11/GoogleTakeout01.png" alt="Les options de Google Takeout" title="Google Takeout" width="540" height="300" class="aligncenter size-full wp-image-345" /></p>

<p>C&rsquo;est là que je me suis souvenu que les partages Google Reader se retrouvaient automatiquement sur Buzz. Logiquement en téléchargeant mes données Buzz je devrais récupérer ce que j&rsquo;ai partagé (je ne m&rsquo;en suis jamais servi autrement que via Reader…)</p>

<p>Et effectivement, Google me propose un fichier zip contenant 287 fichiers html. Oui, un fichier par partage:</p>

<p><a class="picture" href="https://aldarone.fr/wp-content/uploads/2011/11/screenshot.10.png"><img src="https://aldarone.fr/assets/screenshot.10-540x421.png" alt="screenshot.10" title="screenshot.10" width="540" height="421" class="aligncenter size-large wp-image-346" /></a></p>

<p>Et ce n&rsquo;est même pas une capture de la page partagée : il n&rsquo;y a que la photo de profil, et le lien:</p>

<p><a class="picture" href="https://aldarone.fr/wp-content/uploads/2011/11/screenshot.11.png"><img src="https://aldarone.fr/assets/screenshot.11-540x53.png" alt="screenshot.11" title="screenshot.11" width="540" height="53" class="aligncenter size-large wp-image-347" /></a></p>

<p>Ce n&rsquo;est donc pas décemment exploitable. J&rsquo;ai donc passé mon après-midi sur une solution permettant de regrouper tous ces liens et d&rsquo;en faire un fichier bookmarks.html au format Netscape qui puisse être importé dans tous les navigateurs et services de bookmarking. Ça tombe bien, j&rsquo;apprends le PHP, c&rsquo;est un bon exercice.</p>

<p>Étant débutant, il se peut que vous trouviez des choses un peu aberrantes, des endroits où le code peut être optimisé. J&rsquo;ai fait au mieux de mes compétences actuelles, n&rsquo;hésitez pas à me corriger si vous voyez quelque chose qui vous choque.</p>

<p>Il me fallait d&rsquo;abord un outil simple pour parcourir le code HTML et récupérer les éléments nécessaires, j&rsquo;ai trouvé mon bonheur avec « <a href="http://simplehtmldom.sourceforge.net/">PHP Simple HTML DOM Parser</a>. » Ensuite il me fallait des infos sur la norme des bookmarks.html, j&rsquo;ai trouvé ma réponse <a href="http://msdn.microsoft.com/en-us/library/aa753582%28v=vs.85%29.aspx">chez Microsoft</a>.</p>

<p>Le minimum est là, on peut donc commencer:</p>

<pre class="brush: php">
    $file = file_get_contents('./buzz/example.html');
    $html = str_get_html($file);
    $title = $html-&gt;find('div[class=entry-title]', 0)-&gt;plaintext;
    $date = $html-&gt;find('abbr[class=published]', 0)-&gt;title;
    $link = $html-&gt;find('div[class=entry-content]', 0)-&gt;first_child()-&gt;href;

    echo '<DT><A HREF="'.$link.'">'.$title.'</A></DT>'."n";

    $html-&gt;clear();
    unset($html);
</pre>

<p>Les problèmes qui se présentent à ce stade, c&rsquo;est que la date doit être au format UNIX alors que Buzz l&rsquo;a mise dans un format un peu chelou: <code>0000-00-00T00:00:00.000</code>. Dans certains partages, il n&rsquo;y a tout simplement pas de lien, ce qui affole un peu PHP au niveau des E_NOTICE. Et pour finir, le parser n&rsquo;aime pas trop les accents.</p>

<p>Pour résoudre le problème de la date, un peu de comptage de caractères est nécessaire:</p>

<pre class="brush: php">
function date_convert($date){
    $year = substr($date, 0, 4);
    $month = substr($date, 5, 2);
    $day = substr($date, 8, 2);
    $hour = substr($date, 11, 2);
    $min = substr($date, 14, 2);
    $sec = substr($date, 17, 2);

    $date = mktime($hour, $min, $sec, $month, $day, $year);
    return $date;
}
</pre>

<p>Pour les accents c&rsquo;est un peu plus astucieux, il va falloir encoder tous les caractères en HTML puis décoder les balises pour que le parser puisse faire son boulot:</p>

<pre class="brush: php">
function char_convert($text){
    $text = htmlentities($text, ENT_NOQUOTES, "UTF-8");
    $text = htmlspecialchars_decode($text);
    return $text;
}
</pre>

<p>Et pour les fichiers sans lien, un « <code>if</code> » suffit.</p>

<p>Maintenant qu&rsquo;on récupère tout à peu près correctement, on va pouvoir peaufiner. Comme ce sont des liens de flux RSS on voit souvent du <a href="http://feedproxy.google.com/~r/9gag/~3/3dFZLa-CYI8/466983">http://feedproxy.google.com/~r/9gag/~3/3dFZLa-CYI8/466983</a> au lieu d&rsquo;avoir une belle URL claire et limpide. Il va falloir sortir cURL pour faire le ménage (et on va aussi en profiter pour virer les liens morts ainsi que les paramètres que rajoute feedburner pour les statistiques) :</p>

<pre class="brush: php">
function real_url($link){
    if ( ! empty($link) ) { return; }
    $options = array(
     CURLOPT_NOBODY         =&gt; true,     // Asks header only
     CURLOPT_RETURNTRANSFER =&gt; true,     // return web page
     CURLOPT_HEADER         =&gt; true,    // return headers
     CURLOPT_FOLLOWLOCATION =&gt; true,     // follow redirects
     CURLOPT_ENCODING       =&gt; "",       // handle all encodings
     CURLOPT_USERAGENT      =&gt; "spider", // who am i
     CURLOPT_AUTOREFERER    =&gt; true,     // set referer on redirect
     CURLOPT_CONNECTTIMEOUT =&gt; 10,      // timeout on connect
     CURLOPT_TIMEOUT        =&gt; 15,      // timeout on response
     CURLOPT_MAXREDIRS      =&gt; 10,       // stop after 10 redirects
    );

    $ch      = curl_init( $link );
    curl_setopt_array( $ch, $options );
    $content = curl_exec( $ch );
    $err     = curl_errno( $ch );
    $errmsg  = curl_error( $ch );
    $header  = curl_getinfo( $ch );
    curl_close( $ch );

    $http_code = $header["http_code"];
    $url = $header["url"];

    if ( $http_code != 404 ) {
     // Ces trois lignes suppriment les paramètres feedburner.
     // Merci Sebastien SAUVAGE ;D
     $i=strpos($url,'&amp;utm_source='); if ($i) $url=substr($url,0,$i);
     $i=strpos($url,'?utm_source='); if ($i) $url=substr($url,0,$i);
     $i=strpos($url,'#xtor=RSS-'); if ($i) $url=substr($url,0,$i);

     return $url;
    }
    else {
     return;
    }
}
</pre>

<p>Le résultat final est disponible ici : <a href="https://aldarone.fr/assets/buzz2bookmarks.txt">Télécharger le script pour passer de Buzz à bookmarks.html</a>.</p>

<p>J&rsquo;y ai ajouté une variable pour choisir le dossier qui contient les fichiers html de Buzz, ainsi que la boucle qui les parcourt. Il ne prend pas de paramètres et vous aurez besoin du fichier <a href="http://sourceforge.net/projects/simplehtmldom/files/latest/download">simple_html_dom.php</a>. Au niveau du temps d&rsquo;exécution&hellip; La vérification de la validité des liens prend un peu de temps: Pour 287 fichiers il a fallu 5 minutes et le nombre de lien valides est de 209 (mais là ça dépendra de vos partages.)</p>

<p>Maintenant que vous avez vos liens dans un format standard, libre à vous d&rsquo;en faire ce que vous voulez. Pour ma part je pense installer <a href="http://sebsauvage.net/wiki/doku.php?id=php:shaarli">Shaarli</a> prochainement.</p>

    </section>


  <footer class="post-footer">


    

    





<section class="author">
  <h4><a href="https://aldarone.fr/">Alda Marteau-Hardi</a></h4>
  
  <p>Je fais du PHP et du Javascript. Et j&#39;essaye aussi d&#39;être un humain décent.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Alsace, France</span>
    <span class="author-link icon-link"><a href="http://aldarone.fr/">http://aldarone.fr/</a></span>
  </div>
</section>



    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Google%20Takeout%2c%20Buzz%20et%20l%27export%20des%20favoris&nbsp;-&nbsp;Aldarone.fr&amp;url=https%3a%2f%2faldarone.fr%2fgoogle-takeout-buzz-et-lexport-des-favoris"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2faldarone.fr%2fgoogle-takeout-buzz-et-lexport-des-favoris"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2faldarone.fr%2fgoogle-takeout-buzz-et-lexport-des-favoris&amp;description=Google%20Takeout%2c%20Buzz%20et%20l%27export%20des%20favoris"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=https%3a%2f%2faldarone.fr%2fgoogle-takeout-buzz-et-lexport-des-favoris"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    

<div id="isso-thread"></div>
<script src="//comments.aldarone.fr/js/embed.min.js" type="text/javascript" charset="utf-8" data-isso="//comments.aldarone.fr/"></script>
<noscript>Please enable JavaScript to view the <a href="https://posativ.org/isso/">comments powered by Isso.</a></noscript>




  </footer>
</article>

</main>

<aside class="read-next">
  
      <a class="read-next-story" style="no-cover" href="/bye-bye-google-reader-bonjour-feedly">
          <section class="post">
              <h2>Bye bye Google Reader, bonjour Feedly</h2>
              
          </section>
      </a>
  
  
      <a class="read-next-story prev" style="no-cover" href="/les-flux-rss-shaarli-et-pubsubhubbub">
          <section class="post">
              <h2>Les flux RSS, Shaarli et PubSubHubbub</h2>
          </section>
      </a>
  
</aside>

    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Aldarone.fr</a> 2011 - 2016. Publié sous licence Creative Commons Attribution-NoDerivatives 4.0 International</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="https://aldarone.fr/js/jquery.js"></script>
    <script type="text/javascript" src="https://aldarone.fr/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://aldarone.fr/js/index.js"></script>
    
        
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//stats.aldarone.fr/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId',  1 ]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//stats.aldarone.fr/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>


    
</body>
</html>

